- [两个主机的通信过程](#两个主机的通信过程)
  - [两个主机通信如何填对目的主机ip地址？](#两个主机通信如何填对目的主机ip地址)
  - [局域网内两个主机通信如何填对目的主机mac地址？](#局域网内两个主机通信如何填对目的主机mac地址)
  - [不同网络上的两个主机通信如何填对目的主机的mac地址？](#不同网络上的两个主机通信如何填对目的主机的mac地址)
- [什么设备需要有mac地址？](#什么设备需要有mac地址)
  - [为什么交换机没有mac地址？](#为什么交换机没有mac地址)
  - [为什么路由器每个端口都要有mac地址？](#为什么路由器每个端口都要有mac地址)
- [ARP协议特点](#arp协议特点)



# 两个主机的通信过程
## 两个主机通信如何填对目的主机ip地址？
DNS服务


## 局域网内两个主机通信如何填对目的主机mac地址？
1. 首先查源主机的ARP高速缓存（存有源主机所在局域网的ip地址和mac地址的映射）。没有查到则第2步
2. 源主机广播ARP请求![广播ARP请求](https://s1.ax1x.com/2020/05/27/tA1krR.png)目的mac地址全1的帧是广播帧。对于广播帧，交换机的处理是：对所以端口转发。
3. 所有接收到ARP请求的主机检查自己的ip地址是否是目的ip地址；若是则会返回一个单播ARP响应![单播ARP响应](https://s1.ax1x.com/2020/05/27/tA3PFf.png)
4. 源主机接收到ARP响应分组，更新ARP高速缓存。


## 不同网络上的两个主机通信如何填对目的主机的mac地址？
1. 首先查源主机的ARP高速缓存（存有源主机所在局域网的ip地址和mac地址的映射）。没有查到则第2步
2. 检查目的ip是否和源ip在同一个网络内（局域网？子网？这里存疑）：用子网掩码分别与目的ip和源ip相与，看两个结果是否相等。不在同一子网则执行第3步（发给默认网关）
3. 源主机怎么知道默认网关的mac地址呢？源主机发送一个广播ARP请求，请求帧的目的ip填默认网关![广播ARP请求](https://s1.ax1x.com/2020/05/27/tArsmV.png)
4. 所有接收到ARP请求的主机检查自己的ip地址是否是目的ip地址；所以只有默认网关响应该ARP请求，返回一个单播ARP响应![单播ARP响应](https://s1.ax1x.com/2020/05/27/tAynxA.png)
5. 源主机收到ARP响应分组，更新ARP高速缓存。

# 什么设备需要有mac地址？
## 为什么交换机没有mac地址？
交换机负责的功能：连接局域网的设备
mac地址只有需要接收使用帧的设备才需要。主机，路由器都可以接收帧使用而不转发。交换机只是简单的将帧转发到其他端口，它并不使用帧。

没有，理由是实现二层转发不需要接口拥有mac地址。
二层交换机只工作在广播域内，数据帧的源目mac不需要发生转换。交换机不需要对帧进行拆包，不需要理解帧内容，对于交换机来说转发数据帧只需要使用mac地址-端口映射表，所以接口是否有mac地址也不影响数据转发。所以不需要mac地址。

## 为什么路由器每个端口都要有mac地址？
确定每个端口对应的局域网内的主机都可以找到路由器。mac地址就是物理设备的身份，用来在局域网内定位一个物理设备。ip地址是用来在因特网中定位一个局域网。

路由器的功能：存储转发分组。
实现的方式：接收帧拆包，重新封装帧改写源mac地址和目的mac地址，被下一个路由器接收....然后到目的主机或目的网络再到目的主机。

路由的过程就是不断更新帧mac地址的过程


# ARP协议特点
ARP分组（是帧）格式：为了响应可以用单播，请求需要有源主机的ip和mac地址来使得目的主机能更新自己的缓存，然后单播返回响应。
广播请求单播响应
高速缓存提速
