# 三次握手和四次挥手

![三次握手](https://camo.githubusercontent.com/564d582cc74a6293ce8c3231d779467c4525d450/687474703a2f2f696d616765732e636e626c6f67732e636f6d2f636e626c6f67735f636f6d2f736b796e65742f3230313031322f3230313031323132323135373436373235382e706e67)

## [为什么是三次握手？](https://www.jianshu.com/p/e7f45779008a)
本质：在全双工不可靠的信道上建立可靠的数据传输。只有三次握手才能保证全双工双向连接都是通的。

不可靠会导致数据包的乱序，延迟等等问题，tcp协议就是要保证即使发生这些问题也能建立可靠的连接。


### 如果是两次握手：没法保证服务器到客户端是通的（可能客户端并不想建立连接）
两次握手没有对服务器的建立连接的确认，服务器发出ack时就建立连接。
服务器端会轻易的为**迟到并且已经失效**的连接请求建立tcp连接，而陷入空等浪费资源

> 一端(client)A发出去的第一个连接请求报文并没有丢失，而是因为某些未知的原因在某个网络节点上发生滞留，导致延迟到连接释放以后的某个时间才到达另一端(server)B。本来这是一个早已失效的报文段，但是B收到此失效的报文之后，会误认为是A再次发出的一个新的连接请求，于是B端就向A又发出确认报文，表示同意建立连接。如果不采用“三次握手”，那么只要B端发出确认报文就会认为新的连接已经建立了，但是A端并没有发出建立连接的请求，因此不会去向B端发送数据，B端没有收到数据就会一直等待，这样B端就会白白浪费掉很多资源。如果采用“三次握手”的话就不会出现这种情况，B端收到一个过时失效的报文段之后，向A端发出确认，此时A并没有要求建立连接，所以就不会向B端发送确认，这个时候B端也能够知道连接没有建立。

【答案一】因为信道不可靠，而 TCP 想在不可靠信道上建立可靠地传输，那么三次通信是理论上的最小值。（而 UDP 则不需建立可靠传输，因此 UDP 不需要三次握手。）

Google Groups . TCP 建立连接为什么是三次握手？{技术}{网络通信}

【答案二】因为双方都需要确认对方收到了自己发送的序列号，确认过程最少要进行三次通信。

知乎 . TCP 为什么是三次握手，而不是两次或四次？

【答案三】为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误。

《计算机网络（第 7 版）-谢希仁》



## 四次挥手断开连接（全双工连接-->双向断开）
所谓断开连接，是指双方都不发送或者接受对方的信息了。
这需要A告诉B：我没有数据要发给你了 B发给A一个确认：我知道了
这时，A到B的连接就断开了，但是连接是全双工的，B到A的连接还没断开。
所以还要需要B告诉A：我没有数据要发给你了 A发给B一个确认：我知道了


## 为什么要有SYN?
SYN提供了匹配机制，使请求和确认可以一一对应。
同时验证了传输信息的可靠性：数据被正确的接收。

一个源主机可能会对目的主机发很多次请求，一个目标主机会也给源主机回复很多确认，所以必须要知道确认是对哪一次请求的确认，不然会造成混乱。